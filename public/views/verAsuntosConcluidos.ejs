<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>GUM</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
    <script>
        function muestra_oculta(id){
            if (document.getElementById){ //se obtiene el id
            var el = document.getElementById(id); //se define la variable "el" igual a nuestro div
            el.style.display = (el.style.display == 'none') ? 'block' : 'none'; //damos un atributo display:none que oculta el div
            }
            }
    </script>
</head>
<body>
<div class="container">
      <header class="page-header">
        <ul class="nav nav-pills pull-right">
          <li class="active"><a href="/profile">Perfil</a></li>
          <li><a href="/logout">Log out</a></li>
        </ul>
        <h1><%=`Bienvenido ${user.Nombre}, estos son los asuntos concluidos: `%></h1>
      </header>
</div>
<div class="container">
    <% if(!asuntos || !asuntos.length){%>
        <h2 aling="center">No se han concluido Asuntos.</h2>
    <%} else {  %>
    <% for(let i = 0; i < asuntos.length; i++) { %>
            <article style="border:3px solid black; border-color: blue;border-radius: 15px; margin-top: 10px;">
                <h2 role="button" onClick="muestra_oculta('<%=asuntos[i].IdAsunto%>')" style="margin-left: 10px"><%= asuntos[i].Actividad %></h2>
                <div id="<%=asuntos[i].IdAsunto%>" style="word-wrap: break-word; word-break: break-all; margin-right: 10px; margin-left: 10px; display: none;">
                    <h2 role="button" onClick="muestra_subordinados('<%=asuntos[i].IdAsunto%>')" id="<%=asuntos[i].IdAsunto + 'Sub'%>" style="margin-left: 10px">Mostrar Subordinados encargados.</h2>
                    <%= asuntos[i].Descripcion %>
                </div>
            </article>
            <%}%>
    <% } %>
</div>
<script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
<script>
    var socket = io();
    function muestra_subordinados(idAsunto){
    document.getElementById(idAsunto + 'Sub').innerHTML = "<i>Obteniendo subordinados...</i>";
    socket.emit('obtener subordinados', idAsunto);
    }
    socket.on('subordinados asignados', (result, idAsunto) => {
        document.getElementById(idAsunto + 'Sub').innerHTML = "Subordinados asignados al asunto: <br>";
        for (let subor = 0; subor < result.length; subor++) {
            var element = result[subor];
            document.getElementById(idAsunto + 'Sub').innerHTML += `<i>${element.ApPaterno} ${element.ApMaterno} ${element.Nombre}</i> <br>`;
        }
        document.getElementById(idAsunto + 'Sub').onclick = "";
        document.getElementById(idAsunto + 'Sub').role = "";
    });

</script>
</body>
</html>